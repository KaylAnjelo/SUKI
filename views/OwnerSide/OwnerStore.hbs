<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{siteTitle}} - {{pageTitle}}</title>

  <!-- Styles -->
  <link rel="stylesheet" href="/AdminStyles.css">

  <!-- Icons -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link rel="icon" type="image/png" href="/assets/SUKI Logo 2.png">
</head>
<body>
  <div class="container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="logo">
        <h2>{{companyName}}</h2>
      </div>
      <nav class="nav-menu">
        <ul>
          <li><a href="/dashboard"><i class="fas fa-chart-line"></i><span>Dashboard</span></a></li>
          <li><a href="/reports"><i class="fas fa-file-alt"></i><span>Reports</span></a></li>
          <li><a href="/transactions"><i class="fas fa-exchange-alt"></i><span>Transactions</span></a></li>
          <li class="active"><a href="/users"><i class="fas fa-fingerprint"></i><span>Users</span></a></li>
        </ul>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <header class="header">
        <a href="/users" class="back-link"><i class="fas fa-arrow-left"></i></a>
        <h1>{{pageTitle}}</h1>
        <div class="header-actions">
          <div class="notification-bell">
            <i class="fas fa-bell"></i>
            <span class="notification-dot"></span>
          </div>
          <form action="/logout" method="POST">
            <button type="submit" class="logout">{{logoutLabel}}</button>
          </form>
        </div>
      </header>

      {{#if stores.length}}
        <div class="stores-list">
          {{#each stores}}
          <div class="store-card">
            {{#if this.store_image}}
              <div class="store-logo">
                <img src="{{this.store_image}}" alt="{{this.name}} Logo">
              </div>
            {{else}}
              <div class="store-logo">
                <i class="fas fa-store"></i>
              </div>
            {{/if}}
            <h3>{{this.name}}</h3>
            <p>
              Owner:
              {{this.ownerFirstName}}
              {{#if this.ownerSecondName}} {{this.ownerSecondName}}{{/if}}
              {{#if this.ownerMiddleInitial}} {{this.ownerMiddleInitial}}.{{/if}}
              {{this.ownerLastName}}
            </p>
            <p>Email: <a href="mailto:{{this.ownerEmail}}" class="link">{{this.ownerEmail}}</a></p>
            <p>Contact: <a href="tel:{{this.contactInfo}}" class="link">{{this.contactInfo}}</a></p>
            <p>Location: {{this.location}}</p>
            <form action="/users/stores/delete/{{this.id}}" method="POST" style="margin-top:10px;">
              <button type="submit" class="delete-btn">Delete</button>
            </form>
          </div>
          {{/each}}
        </div>
      {{else}}
        <div class="empty-panel">
          <div class="empty-icon"><i class="fas fa-store"></i></div>
          <div class="empty-title">No stores at this time</div>
          <div class="empty-subtitle">Start by adding your first store.</div>
        </div>
      {{/if}}

      <!-- Add Store Button -->
      <button class="add-btn add-store-btn">+ Add Store</button>
    </main>
  </div>

  <!-- Add Store Modal -->
  <div id="addStoreModal" class="modal">
    <div class="modal-content modal-animate">
      <div class="modal-header">
        <h2>Register Store</h2>
        <button class="store-close">&times;</button>
      </div>

      <form action="/users/stores/add" method="POST" enctype="multipart/form-data" class="add-store-form">
        <!-- Store Name -->
        <div class="input-group">
          <label for="storeName">Store Name</label>
          <input type="text" id="storeName" name="storeName" required>
        </div>

        <!-- Owner's First Name -->
        <div class="input-group">
          <label for="ownerFirstName">Owner's First Name</label>
          <input type="text" id="ownerFirstName" name="ownerFirstName" required>
        </div>

        <!-- Owner's Last Name -->
        <div class="input-group">
          <label for="ownerLastName">Owner's Last Name</label>
          <input type="text" id="ownerLastName" name="ownerLastName" required>
        </div>

        <!-- Owner's Email -->
        <div class="input-group">
          <label for="ownerEmail">Owner's Email</label>
          <input type="email" id="ownerEmail" name="ownerEmail" required>
        </div>

        <!-- Contact Information -->
        <div class="input-group">
          <label for="contactInfo">Contact Information</label>
          <input type="text" id="contactInfo" name="contactInfo" required>
        </div>

        <!-- Location -->
        <div class="input-group">
          <label for="location">Location</label>
          <input type="text" id="location" name="location" required>
        </div>

        <!-- Store Logo -->
        <div class="input-group">
          <label for="storeImage">Store Logo</label>
          <input type="file" id="storeImage" name="storeImage" accept="image/*" required>
        </div>

        <!-- Actions -->
        <div class="form-actions">
          <button type="button" class="store-cancel cancel-btn">Cancel</button>
          <button type="submit" class="submit-btn">Register</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Scripts -->
  <script src="/notifications.js"></script>
  <script src="/logout.js"></script>
  <script src="/sidebar.js"></script>
  <script src="/stores.js"></script>
  <script>
    // Toggle modal visibility
    document.querySelector('.add-store-btn').addEventListener('click', function() {
      document.getElementById('addStoreModal').style.display = 'block';
    });

    document.querySelector('.store-close').addEventListener('click', function() {
      document.getElementById('addStoreModal').style.display = 'none';
    });

    // Preview uploaded store logo
    document.getElementById("storeImage").addEventListener("change", function(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const previewDiv = document.getElementById("imagePreview");
          previewDiv.innerHTML = `<img src="${e.target.result}" alt="Store Logo" style="max-width: 200px; max-height: 200px; object-fit: cover;">`;
        };
        reader.readAsDataURL(file);
      }
    });
  </script>
</body>
</html>